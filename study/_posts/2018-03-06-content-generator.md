---
layout: post
title: Lesson 11 - PHP 파일 관련 명령어 알아보기 & 콘텐츠 발행기 만들기
categories: study
---

이번 강의에서는 데이터베이스나 필터를 사용하지 않고 PHP로만 콘텐츠 생성기를 만드는 법을 배워본다. PHP가 새로운 파일을 생성해주고 그 파일의 경로로 접근하여 열람하는 구조.

## 콘텐츠 발행기 만들기 
* 닷홈 서버에 FTP로 연결한 후, cms라는 폴더를 만든다.
* cms 폴더 안에 index.php 파일을 만든다.
* post_list.txt 라는 파일을 만든다.
* index.php 파일을 열고 주어진 코드를 제일 첫줄에 넣고 저장한다.

### PHP 코드
![코드](http://mocha.dothome.co.kr/images/11-1.png)
* LINE 2-4: POST 방식으로 값을 받을건데, 그 네임들은 title, text, url이다 + 변수 정의.
* LINE 6: 각 각의 넘겨 받은 값(변수)의 내용이 비어있지 않다면 == 어떠한 데이터가 입력되어 넘어 왔다면 (타이틀과 텍스트 그리고 URL의 값이 모두 입력되었다면)
* LINE 14: 위에서 넘겨 받은 $title 출력
* LINE 22: 넘어온 url 값의 뒤에 확장자 추가
* LINE 24: fopen이라는 명령어로 파일을 불러 들이는데, 그 파일의 이름은 방금 선언한 permalink이다. 그리고 그 파일에 w(쓰기 전용)라는 옵션을 줄 것이다(현재 생성되어 있는 파일중에는 permalink를 가지는 이름의 파일은 없지만, php가 자동으로 생성할 것임).
* LINE 25: 위에서 연 파일($post_file)에 $content에 담긴 내용을 쓸 것이다.
* LINE 26: 파일을 닫는다.
* LINE 28: post_list.txt라는 파일을 생성(불러들이기) 할 것인데, 옵션에는 a+(읽고 쓰기)를 지정하겠다(post_list.txt에는 게시글의 주소값 리스트를 담을 예정 - 카테고리 용도)
* LINE 29: 이 파일에 쓸 내용은 $permalink 값인데, 끝에 '\n (줄 바꿈)'을 넣을 것이다(향후에 한 줄씩 읽어 들여서, 리스트 목록을 생성하기 위함).

### HTML 코드
* 위의 PHP 코드를 '?>'로 닫고, 주어진 html 코드를 추가한다.
* 닷홈/cms 주소로 이동해서 발행기가 화면에 제대로 뜨는지 확인한다.
* '발행하기'를 누르면 같은 디렉토리 내에 파일이 생성된다. 해당 주소로 이동하면 내용이 제대로 뜨는지 확인.

### 리스트 링크 값 출력 PHP 코드
HTML 코드 아래에 리스트 링크 값을 출력해주는 PHP 코드를 붙인다.

![코드](![코드](http://mocha.dothome.co.kr/images/11-2.png)
* LINE 66: post_list.txt 라는 파일 이름을 변수에 담아둔다.
* LINE 67: 읽기 옵션('r')을 넣겠다. 게시글 링크 리스트를 읽어들이는 목적.
* LINE 69: for / foreach 같은 while '반복문'. 뒤에 나오는 괄호의 내용이 '거짓'일 때까지 계속 반복. 보통 text 파일에서 한 줄씩 읽어올 때 많이 사용하는 편. feof는 파일의 포인터 위치가 파일의 끝 부분인지 아닌지를 확인하는 명령어. 이 코드에는 앞에 '!(부정)'이 붙어있으므로 '혹시 끝이 아니냐?'라는 뜻.
* LINE 70: 한 줄 씩 내용 담기 (윗 부분에서 '\n'을 붙여서 줄 바꿈을 해준 이유. 밑에서 한줄씩 끊어서 읽어들이기 위해)
* 드용님이 주석 포함해서 올려주신 이미지 참고하기. 

이렇게 PHP로 콘텐츠 발행기 만드는 법을 알아봤다. 하지만 호스팅에 따라 파일 갯수 제한이 있는 곳도 있고, 폴더 및 파일이 많아질수록 하드디스크에 무리가 가고 탐색 시간이 느려진다. 따라서, DB를 연결해서 사용하면 콘텐츠를 효율적으로 관리할 수 있다. DB를 쓰면 무차별적으로 파일이 생성되는 것이 아닌, 하나의 파일에서 값만 바꿔준다. 워프에 DB가 필요한 이유! 문서 5천개가 있다면, 위의 방식대로라면 파일이 5천개 생성되지만, DB를 쓴다면 파일은 언제나 한 개.

### 응용! 페이지 카운터 만들기
카운터 코드 참고하기.


